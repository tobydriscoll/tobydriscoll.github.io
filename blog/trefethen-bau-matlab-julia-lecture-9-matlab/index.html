<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 5.7.0 for Hugo"><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=preload as=style href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&family=Roboto+Mono&family=Roboto:wght@400;700&display=swap" media=print onload='this.media="all"'><link rel=stylesheet href=/css/vendor-bundle.min.16f785cdb553c8c4431db6775122af35.css media=print onload='this.media="all"'><link rel=stylesheet href=/css/wowchemy.24595df0c2dd320a6929bb350c13027d.css><link rel=stylesheet href=/css/libs/chroma/github-light.min.css title=hl-light media=print onload='this.media="all"' disabled><link rel=stylesheet href=/css/libs/chroma/dracula.min.css title=hl-dark media=print onload='this.media="all"'><meta name=author content="Toby Driscoll"><meta name=description content="For today&rsquo;s notebooks I got caught on a problem I anticipated in theory but failed to spot in practice for longer than I would like to admit.
First let me mention how interesting this Lecture is to me personally."><link rel=alternate hreflang=en-us href=https://tobydriscoll.net/blog/trefethen-bau-matlab-julia-lecture-9-matlab/><link rel=canonical href=https://tobydriscoll.net/blog/trefethen-bau-matlab-julia-lecture-9-matlab/><link rel=manifest href=/manifest.webmanifest><link rel=icon type=image/png href=/media/icon_hudca3d2a3171f399896ba920e49ec6cc3_21724_32x32_fill_lanczos_center_3.png><link rel=apple-touch-icon type=image/png href=/media/icon_hudca3d2a3171f399896ba920e49ec6cc3_21724_180x180_fill_lanczos_center_3.png><meta name=theme-color content="#bbdefb"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://tobydriscoll.net/media/logo_hueac33246f157bcd904a645b7aca24b63_24178_300x300_fit_lanczos_3.png"><meta property="og:site_name" content="Toby Driscoll"><meta property="og:url" content="https://tobydriscoll.net/blog/trefethen-bau-matlab-julia-lecture-9-matlab/"><meta property="og:title" content="Trefethen &  Bau &   MATLAB &   Julia, Lecture 9: MATLAB | Toby Driscoll"><meta property="og:description" content="For today&rsquo;s notebooks I got caught on a problem I anticipated in theory but failed to spot in practice for longer than I would like to admit.
First let me mention how interesting this Lecture is to me personally."><meta property="og:image" content="https://tobydriscoll.net/media/logo_hueac33246f157bcd904a645b7aca24b63_24178_300x300_fit_lanczos_3.png"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2016-09-20T19:52:34+00:00"><meta property="article:modified_time" content="2016-09-20T19:52:34+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"https://tobydriscoll.net/blog/trefethen-bau-matlab-julia-lecture-9-matlab/"},"headline":"Trefethen \u0026  Bau \u0026   MATLAB \u0026   Julia, Lecture 9: MATLAB","datePublished":"2016-09-20T19:52:34Z","dateModified":"2016-09-20T19:52:34Z","author":{"@type":"Person","name":"Toby Driscoll"},"publisher":{"@type":"Organization","name":"Toby Driscoll","logo":{"@type":"ImageObject","url":"https://tobydriscoll.net/media/logo_hueac33246f157bcd904a645b7aca24b63_24178_192x192_fit_lanczos_3.png"}},"description":"For today\u0026rsquo;s notebooks I got caught on a problem I anticipated in theory but failed to spot in practice for longer than I would like to admit.\nFirst let me mention how interesting this Lecture is to me personally."}</script><title>Trefethen & Bau & MATLAB & Julia, Lecture 9: MATLAB | Toby Driscoll</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents class="page-wrapper dark" data-wc-page-id=7e7e43974e2db96962d7cb980c063257><script src=/js/wowchemy-init.min.2a7b4dc7d7846171b6299e17e1f3ac71.js></script><div class="page-header header--fixed"><header><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container-xl><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/><img src=/media/logo_hueac33246f157bcd904a645b7aca24b63_24178_0x70_resize_lanczos_3.png alt="Toby Driscoll"></a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar-content aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/><img src=/media/logo_hueac33246f157bcd904a645b7aca24b63_24178_0x70_resize_lanczos_3.png alt="Toby Driscoll"></a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/post><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/publication><span>Publications</span></a></li><li class=nav-item><a class=nav-link href=/tag/book><span>Books</span></a></li><li class=nav-item><a class=nav-link href=/tag/software><span>Software</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"></ul></div></nav></header></div><div class=page-body><article class=article><div class="article-container pt-3"><h1>Trefethen & Bau & MATLAB & Julia, Lecture 9: MATLAB</h1><div class=article-metadata><span class=article-date>Sep 20, 2016</span>
<span class=middot-divider></span>
<span class=article-reading-time>4 min read</span>
<span class=middot-divider></span>
<span class=article-categories><i class="fas fa-folder mr-1"></i><a href=/category/uncategorized/>Uncategorized</a></span></div></div><div class=article-container><div class=article-style><p>For <a href=https://gist.github.com/tobydriscoll/3030cf16ae47dc58a4b51d9b47c8289b target=_blank rel=noopener>today&rsquo;s notebooks</a> I got caught on a problem I anticipated in theory but failed to spot in practice for longer than I would like to admit.</p><p>First let me mention how interesting this Lecture is to me personally. The title of the lecture is &ldquo;MATLAB&rdquo;, and it details three numerical experiments. The first of these uses QR factorization of a discretization of monomials in order to approximate the Legendre polynomials. I skipped this one here because I opted in class to show how Gram-Schmidt looks using <a href=www.chebfun.org>Chebfun</a>. (It&rsquo;s awesome.)</p><p>The other two numerical experiments show different aspects of numerical instability of the Gram-Schmidt algorithm, classical and modified. The MATLAB version looks just like I would have written it 20 years ago:</p><pre><code class=language-matlab>[U,S,V] = svd(randn(80));
s = 2.^(-1ðŸ‘Ž-80);
A = U*diag(s)*V';
semilogy(s,'.')
[Qc,Rc] = gs(A); &amp;nbsp;% classical
hold on, semilogy(diag(Rc),'o')
[Qm,Rm] = mgs(A); % modified
semilogy(diag(Rm),'s')
</code></pre><p>The idea is that the diagonal elements of <code>R</code> descend exponentially just like the singular values do. If you run this code (or peek at the link at the top), you see that MGS stops tracking them right around machine precision, whereas the less stable classical version wanders off at about half of the available digits.</p><p>I did introduce my own wrinkle here. I can&rsquo;t believe I haven&rsquo;t thought of using this for teaching before, but by the conversion <code>A=single(A)</code> I can simulate a different value of machine epsilon without changing anything else! It backs up the observations from the first graph.</p><p>In Julia this gambit ran into a big snag. Here was my first code for MGS:</p><pre><code class=language-julia>function mgs(A)
  m,n = size(A);
  Q = zeros(m,n); R = zeros(n,n);
  for j = 1:n
    R[j,j] = norm(A[:,j]);
    Q[:,j] = A[:,j]/R[j,j];
    R[j,j+1:n] = Q[:,j]'*A[:,j+1:n];
    A[:,j+1:n] -= Q[:,j]*R[j,j+1:n];
  end
  return Q,R
end
</code></pre><p>Everything was fine in double precision. After a couple of missteps, I figured out how to make `A`` single precision:</p><pre><code class=language-julia>A = convert(Array{Float32},A)
</code></pre><p>Not beautiful, but it works. However, while it had the desired effect on MGS, it did nothing to classical GS! It finally came down to a surprise:</p><pre><code class=language-julia>julia&gt; typeof( 1.0f0 + 1.0f0 )
Float32

julia&gt; typeof( 1.0f0 + 1.0 )
Float64
</code></pre><p>A single plus a double is double. The rule in Julia is that the operands are converted to a type that can represent them both. MATLAB gives a different outcome, converting both numbers to single:</p><pre><code class=language-matlab>&gt;&gt; class( single(1) + 1 )
ans =
single
</code></pre><p>I suppose the philosophy here is that there&rsquo;s no point padding the numbers with meaningless digits&mdash;the moment you introduce a single precision value, you&rsquo;ve chosen that level of precision. I think that&rsquo;s the more sensible choice for floating point; Julia is concerned with the consistency of its much more intricate and far-reaching type system. For Julia I changed the initialization of <code>Q</code> and <code>R</code> to</p><pre><code class=language-julia>Q = zeros(A);
R = zeros(Q[1:n,1:n]);
</code></pre><p>That way they are initialized with the correct type in either case.</p><p>Now for the bonehead move of the day. I seemed to get inconsistent and nonreproducible results in the single precision cases. I went away, did other things, came back into a fresh session, and&mldr;no difference between double and single precision. I may have said a few things I now come to regret. Finally I remembered the key: Julia passes by reference, not value. MGS alters the input matrix, which has no effect outside the function in MATLAB but changes the &lsquo;master copy&rsquo; in Julia. A little switch to</p><pre><code class=language-julia>function mgs(B)
  A = copy(B);
</code></pre><p>and all was well. This is an example of how much MATLAB has shaped my thinking about programming. IIRC, MATLAB doesn&rsquo;t always pass by value; if an input argument is not altered, it is not copied. But it&rsquo;s handled by the compiler, not the programmer.</p><p>If nothing else I&rsquo;m getting ever more clarity on the ways MATLAB keeps things simple. Variables are bound to their values, period. Single precision is an irrevocable choice. Scalars and 1x1 matrices are the same thing. Don&rsquo;t it always seem to go that you don&rsquo;t know what you&rsquo;ve got &rsquo;til it&rsquo;s gone?</p></div><div class=share-box><ul class=share><li><a href="https://twitter.com/intent/tweet?url=https%3A%2F%2Ftobydriscoll.net%2Fblog%2Ftrefethen-bau-matlab-julia-lecture-9-matlab%2F&amp;text=Trefethen+%26++Bau+%26+++MATLAB+%26+++Julia%2C+Lecture+9%3A+MATLAB" target=_blank rel=noopener class=share-btn-twitter aria-label=twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Ftobydriscoll.net%2Fblog%2Ftrefethen-bau-matlab-julia-lecture-9-matlab%2F&amp;t=Trefethen+%26++Bau+%26+++MATLAB+%26+++Julia%2C+Lecture+9%3A+MATLAB" target=_blank rel=noopener class=share-btn-facebook aria-label=facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=Trefethen%20%26%20%20Bau%20%26%20%20%20MATLAB%20%26%20%20%20Julia%2C%20Lecture%209%3A%20MATLAB&amp;body=https%3A%2F%2Ftobydriscoll.net%2Fblog%2Ftrefethen-bau-matlab-julia-lecture-9-matlab%2F" target=_blank rel=noopener class=share-btn-email aria-label=envelope><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=https%3A%2F%2Ftobydriscoll.net%2Fblog%2Ftrefethen-bau-matlab-julia-lecture-9-matlab%2F&amp;title=Trefethen+%26++Bau+%26+++MATLAB+%26+++Julia%2C+Lecture+9%3A+MATLAB" target=_blank rel=noopener class=share-btn-linkedin aria-label=linkedin-in><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=Trefethen+%26++Bau+%26+++MATLAB+%26+++Julia%2C+Lecture+9%3A+MATLAB%20https%3A%2F%2Ftobydriscoll.net%2Fblog%2Ftrefethen-bau-matlab-julia-lecture-9-matlab%2F" target=_blank rel=noopener class=share-btn-whatsapp aria-label=whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=https%3A%2F%2Ftobydriscoll.net%2Fblog%2Ftrefethen-bau-matlab-julia-lecture-9-matlab%2F&amp;title=Trefethen+%26++Bau+%26+++MATLAB+%26+++Julia%2C+Lecture+9%3A+MATLAB" target=_blank rel=noopener class=share-btn-weibo aria-label=weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><a href=https://tobydriscoll.net/><img class="avatar mr-3 avatar-circle" src=/author/toby-driscoll/avatar_hu87468fbd7d8ed7ca5c1214e0740706c6_930052_270x270_fill_q85_lanczos_center.jpg alt="Toby Driscoll"></a><div class=media-body><h5 class=card-title><a href=https://tobydriscoll.net/>Toby Driscoll</a></h5><h6 class=card-subtitle>Professor of Mathematical Sciences</h6><p class=card-text>My research interests are in scientific computation, mathematical software, and applications of mathematics in the life sciences.</p><ul class=network-icon aria-hidden=true><li><a href=/#contact><i class="fas fa-envelope"></i></a></li><li><a href="https://scholar.google.com/citations?user=V2c1tmAAAAAJ&amp;hl=en" target=_blank rel=noopener><i class="ai ai-google-scholar"></i></a></li><li><a href=https://github.com/tobydriscoll target=_blank rel=noopener><i class="fab fa-github"></i></a></li><li><a href=https://www.youtube.com/channel/UCcDR49dQ8fGiJfF-vAxEDNw target=_blank rel=noopener><i class="fab fa-youtube"></i></a></li><li><a href=https://orcid.org/0000-0002-1490-2545 target=_blank rel=noopener><i class="ai ai-orcid"></i></a></li><li><a href=/media/cv.pdf><i class="ai ai-cv"></i></a></li></ul></div></div></div></article></div><div class=page-footer><div class=container><footer class=site-footer><p class=powered-by>Published with <a href="https://wowchemy.com/?utm_campaign=poweredby" target=_blank rel=noopener>Wowchemy</a> â€” the free, <a href=https://github.com/wowchemy/wowchemy-hugo-themes target=_blank rel=noopener>open source</a> website builder that empowers creators.</p></footer></div></div><script src=/js/vendor-bundle.min.d26509351aa0ff874abbee824e982e9b.js></script>
<script id=page-data type=application/json>{"use_headroom":true}</script><script src=/js/wowchemy-headroom.db4755770454eb63685f8de785c0a172.js type=module></script>
<script src=/en/js/wowchemy.min.cac6f31121e70d7b5e433048bdeb0af6.js></script><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i> Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i> Download</a><div id=modal-error></div></div></div></div></div><script src=/js/wowchemy-publication.68f8d7090562ca65fc6d3cb3f8f2d2cb.js type=module></script></body></html>